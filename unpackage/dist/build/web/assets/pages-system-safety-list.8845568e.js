import{_ as e,W as a,p as t,n,o as r,c as i,w as s,i as l,a as o,d,t as u,e as c,f as p,F as m,g,h,L as f,v as _,j as b,k as y,l as C,m as x}from"./index-b4e560e4.js";import{_ as w}from"./uni-stat-breadcrumb.15e35830.js";import{_ as z}from"./uni-dateformat.644bba65.js";import{_ as j}from"./uni-pagination.60f5d58e.js";import{_ as k}from"./unicloud-db.7f6003eb.js";const D=a.database(),V=["user_id.username","user_id.nickname","type","ip"];const $=e({data:()=>({collectionList:[D.collection("uni-id-log").field("type, ip, create_date, user_id").getTemp(),D.collection("uni-id-users").field("_id, username,nickname").getTemp()],query:"",where:"",orderby:"create_date desc",options:{pageSize:20,pageCurrent:1}}),methods:{getWhere(){const e=this.query.trim();if(!e)return"";let a;try{a=new RegExp(e,"i")}catch(n){return void t({title:"请勿输入等不满足正则格式的符号",icon:"none"})}return V.map((e=>a+".test("+e+")")).join(" || ")},search(){const e=this.getWhere(),a=e===this.where;this.where=e,a&&this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.$refs.udb.loadData({current:e.current})},navigateTo(e){n({url:e,events:{refreshData:()=>{this.loadData()}}})},selectedItems(){let e=this.$refs.udb.dataList;return this.selectedIndexs.map((a=>e[a]._id))},delTable(){this.$refs.udb.remove(this.selectedItems())},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e)}}},[["render",function(e,a,t,n,D,V){const $=g(h("uni-stat-breadcrumb"),w),q=f,v=_,T=l,I=g(h("uni-th"),b),L=g(h("uni-tr"),y),P=g(h("uni-td"),C),U=g(h("uni-dateformat"),z),W=g(h("uni-table"),x),S=g(h("uni-pagination"),j),E=g(h("unicloud-db"),k);return r(),i(T,null,{default:s((()=>[o(T,{class:"uni-header"},{default:s((()=>[o($,{class:"uni-stat-breadcrumb-on-phone"}),o(T,{class:"uni-group"},{default:s((()=>[o(q,{class:"uni-search",type:"text",modelValue:D.query,"onUpdate:modelValue":a[0]||(a[0]=e=>D.query=e),onConfirm:V.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),o(v,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:V.search},{default:s((()=>[d(u(e.$t("common.button.search")),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),o(T,{class:"uni-container"},{default:s((()=>[o(E,{ref:"udb",collection:D.collectionList,options:D.options,where:D.where,"page-data":"replace",orderby:D.orderby,getcount:!0,"page-size":D.options.pageSize,"page-current":D.options.pageCurrent},{default:s((({data:e,pagination:a,loading:t,error:n})=>[o(W,{loading:t,emptyText:n.message||"没有更多数据",border:"",stripe:""},{default:s((()=>[o(L,null,{default:s((()=>[o(I,{align:"center"},{default:s((()=>[d("序号")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("用户名")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("昵称")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("内容")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("IP")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("时间")])),_:1})])),_:1}),(r(!0),c(m,null,p(e,((e,t)=>(r(),i(L,{key:t},{default:s((()=>[o(P,{align:"center"},{default:s((()=>[d(u((a.current-1)*a.size+(t+1)),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[d(u(e.user_id[0]&&e.user_id[0].username||"-"),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[d(u(e.user_id[0]&&e.user_id[0].nickname||"-"),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[d(u(e.type),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[d(u(e.ip),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[o(U,{date:e.create_date,threshold:[0,0]},null,8,["date"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText"]),o(T,{class:"uni-pagination-box"},{default:s((()=>[o(S,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:V.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","options","where","orderby","page-size","page-current"])])),_:1})])),_:1})}]]);export{$ as default};
